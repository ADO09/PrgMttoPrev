@{
    ViewData["Title"] = "Home Page";
}
@model List<MttoListModel>





<div class="card movil">
    <div class="card-header">MANTENIMIENTOS</div>
    <div class="card-body">
        <div class="container-buttons-listado">

            @* <a class="btn btn-primary btn-sm" id="btnFiltrar">&#9881;</a> *@
        </div>
        <hr />


        <div class="container-items">

            <table class="table">
                <thead>
                    @if (Model.Any())
                    {
                        <tr>
                            <th>Linea</th>
                            <th>Planta</th>

                            @*          <th>realizado por</th>
                        <th>revisado por</th>
                        *@

                            <th>fecha proggramada</th>


                            @*    <th>Fecha realizada</th> *@
                            <th>Serie</th>
                            <th> Estatus </th>
                            <th>Estacion</th>
                            @*   <th>Problemas encontrados</th>
                        <th>Cambios realizados</th> *@
                            @*  <th>Comentarios</th> *@

                            @*  <th>Estado</th> *@
                            <th></th>
                        </tr>
                    }
                </thead>
                <tbody>
                    @if (Model.Any())
                    {
                        @foreach (var item in Model)
                        {
                            <tr class="container-RowData" id="idRowdata">
                                <td style="display:none" class="IdMTTO">@item.IdMTTO</td>
                                <td class="IdLinea">@item.IdLinea</td>
                                <td class="IdPlanta">@item.IdPlanta</td>


                                <td style="display:none" class="RalP">@item.RealizadoPor</td>
                                <td style="display:none" class="RevP">@item.RevisadoPor</td>
                                <td style="display:none" class="aprvP">@item.AprobadoPor</td>

                                <td class="FechaPROG">@item.FechaPROG</td>


                                <td style="display:none" class="FR">@item.FechaRealiz</td>



                                <td class="Nserie">@item.Nserie</td>
                                <td class="Estatus">@item.Estatus</td>
                                <td class="Estacion">@item.Estacion</td>


                                <td style="display:none" class="PE">@item.ProblemasEncontrados</td>
                                <td style="display:none" class="CR">@item.CambiosRealizados</td>



                                <td style="display:none" class="cm">@item.Comentarios</td>



                                @*          <td><img  src="@item.path_imagen" alt="" width="50px" height="50px" alt="Card image cap" loading="lazy"
                        style="aspect-ratio: 16/9;object-fit:cover;cursor:pointer;border-radius:7px"></td>
                        <td style="max-width: 300px;">
                        \   <p class="card-text-small" title="@item.comentario">
                        @item.comentario
                        </p>
                        </td>

                        <td>
                        <small>@item.FechaPROG</small>
                        <small>@item.FechaRealiz</small>
                        </td>
                        <td>
                        @if (item.estado != null)
                        {
                        <p class="right @(item.estado.Value ? "activo" : "finalizado")">
                        @(item.estado.Value ? "Activo" : "Finalizado")
                        </p>

                        }
                        </td>  *@

                                <td>
                                    <div class="container-button-liberar">
                                        @if (item.Estatus != null)
                                        {
                                            @if (item.Estatus == "activo")
                                            {
                                                <button class="btn btn-danger btn-sm" id="btnLiberarP" name="@item.IdMTTO">Liberar</button>
                                            }
                                            else if (item.Estatus == "pendiente")
                                            {
                                                <button class="btn btn-warning btn-sm" id="btnInfoLiberarP" @* name="@item.path_imagen_after" *@>pendiente</button>
                                                @*  <p style="display: none;" id="perosnaLiberaHide">@item.persona_libera</p>
                                <p style="display: none;" id="fechaLiberacion">@item.updated_at</p> *@
                                            }

                                            @*   <small>@item.created_at</small> *@

                                        }

                                    </div>
                                </td>

                                @* <td>
                        <a asp-action="Producto" asp-controller="Home" asp-route-idProducto="@item.id"
                        class="btn btn-primary btn-sm">Editar</a>
                        <a asp-action="Eliminar" asp-controller="Home" asp-route-idProducto="@item.id"
                        class="btn btn-danger btn-sm">Eliminar</a>
                        </td> *@
                            </tr>
                        }
                    }
                    else
                    {
                    <td><p>No hay registros disponibles.</p></td>
                    }


                </tbody>

            </table>


            <div class="container-card-item">
                @if (Model.Any())
                {
                    @foreach (var item in Model)
                    {
                        <div class="card item">
                            @* <img class="card-img-top" src="@item.path_imagen" alt="Card image cap" loading="lazy" /> *@
                            <div class="card-body">
                                <div class="container-description">
                                    @* <p id="idHide" style="display: none;">@item.id</p> *@
                                    <p>Planta:</p>
                                    <p class="right">@item.IdLinea</p>
                                    <p>Linea:</p>
                                    <p class="right">@item.IdPlanta</p>
                                    <p>Estación:</p>
                                    <p class="right">@item.RealizadoPor</p>
                                    <p class="right">@item.RevisadoPor</p>
                                    <p class="right">@item.FechaPROG</p>
                                    <p class="right">@item.FechaRealiz</p>
                                    @*    <p>Estado:</p>
                            @if (item.estado != null)
                            {
                            <p class="right @(item.estado.Value ? "activo" : "finalizado")">
                            @(item.estado.Value ? "Activo" : "Finalizado")
                            </p>

                            } *@

                                </div>
                                <hr>
                                <p>Comentario: </p>
                                @* <p class="card-text">
                        @item.comentario
                        </p> *@
                                <hr>
                                <div class="container-button-liberar">
                                    @if (item.Estatus != null)
                                    {
                                        @if (item.Estatus == "activo")
                                        {
                                            <button class="btn btn-danger btn-sm" id="btnLiberarP" name="@item.IdMTTO">Liberar</button>
                                        }
                                        else if (item.Estatus == "pendiente")
                                        {
                                            <button class="btn btn-warning btn-sm" id="btnInfoLiberarP" @* name="@item.path_imagen_after" *@>pendiente</button>
                                            @*  <p style="display: none;" id="perosnaLiberaHide">@item.persona_libera</p>
                            <p style="display: none;" id="fechaLiberacion">@item.updated_at</p> *@
                                        }

                                        @*   <small>@item.created_at</small> *@

                                    }

                                </div>
                            </div>
                        </div>
                    }
                }
                else
                {
                    <p>No hay registros disponibles.</p>
                }
            </div>




        </div>


        <div class="container-bt-add">
            <div class="m-2">
                <button type="button" id="btnAddProgandPDF" class="btn btn-success btnAddProgandPDF">
                    Agregar programacion nueva
                    <img src="/images/add.png" id="idimgAddProgandPDF" alt="Descripción de la imagen">
                </button>

                <button type="button" id="idBtnAddMtto" class="btn btn-success idbtnAddMtto">
                    <img src="/images/add.png" id="idimgAddMtto" alt="Descripción de la imagen">
                </button>
            </div>
        </div>
        <div class="container-itemsD">
        </div>

    </div>
</div>



<div class="modal fade" id="ModalAddprogMtto" tabindex="-1" aria-labelledby="AddprogMttoModallabel"
     aria-hidden="true">
    <div class="modal-dialog modal-sm">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ModalAddprogMttolabel">Agregar programacion de preventivo</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="formAddProgramacionMtto" class="formAddProgramacionMtto">

                    <div class="mb-2">
                        <label for="selectfecha">Elige la primera fecha a realizar el mantenimiento</label>
                        <input type="date" id="selectfecha" name="FechaPROG" class="form-control form-control-sm">
                    </div>
                    <div class="mb-2">
                        <label for="realizadoPor">Persona que realiza el mtto</label>
                        <input type="text" id="realizadoPor" class="form-control form-control-sm" name="realizadoPor">
                    </div>
                    <div class="mb-2">
                        <label for="revisadoPor">Persona que revisa el mtto</label>
                        <input type="text" id="revisadoPor" class="form-control form-control-sm" name="revisadoPor">
                    </div>
                    <div class="mb-2">
                        <label for="aprobadoPor">Persona que aprueva el mtto</label>
                        <input type="text" id="aprobadoPor" class="form-control form-control-sm" name="aprobadoPor">
                    </div>
                    <div class="mb-2">
                        <label for="Sup-Is">Sup-Is</label>
                        <input type="text" id="Sup-Is" class="form-control form-control-sm" name="SupIs">
                    </div>
                    <div class="mb-2">
                        <label for="Gte-Is">Gte-Is</label>
                        <input type="text" id="Gte-Is" class="form-control form-control-sm" name="GteIs">
                    </div>
                    <div class="mb-2">
                        <label for="Planta">Planta</label>
                        <select id="planta" class="form-select" aria-label="Default select example" name="planta">
                            <option selected>Open this select menu</option>
                            <option value="MCH1">Mch1</option>
                            <option value="MCH2">MCH2</option>
                            <option value="MCH3">MCH3</option>
                        </select>
                    </div>




                    @*   <div class="mb-2">
                    <label for="imageAfter">Imagen</label>
                    <input type="file" id="imagenAfter" class="form-control form-control-sm" name="imagen_after"
                    accept="image/*">
                    </div> *@



                    <hr>

                    <div class="container-buttons">
                        <button type="submit" id="btnGuardarProgramacionMtto" class="btn btn-success btn-sm btnAddProgMtto">Add</button>
                    </div>

                </form>

            </div>
        </div>
    </div>
</div>

@* MODAL UPDATE *@
<div class="modal fade" id="modalMostrarDetallesandUpdt" tabindex="-1" aria-labelledby="MostrarDetallesandUpdtModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ModaMostrarDetallesandUpdtlLabel">Mantenimiento preventivos</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="formMostrarDetallesAndUpdate" class="formMostrarDetallesAndUpdate">
                    @*   <div class="mb-2">
                    <label for="imageAfter">Imagen</label>
                    <input type="file" id="imagenAfter" class="form-control form-control-sm" name="imagen_after"
                    accept="image/*">
                    </div> *@


                    @* <div class="mb-2">
                    <label for="contra">contraseña</label>
                    <input type="password" id="contra" class="form-control form-control-sm" name="contra">
                    </div>*@


                    <hr>

                    @*    <div class="container-buttons">
                    <button type="submit" id="btnGuardarLiberar" class="btn btn-success btn-sm">Liberar</button>
                    </div>
                    *@
                </form>

            </div>
        </div>
    </div>
</div>







@* Modal ADD *@
<div class="modal fade" id="ModalADDmtto" tabindex="-1" aria-labelledby="ADDmttoModalLabel"
     aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="ModalADDmttoLabel">Agregar Mantenimiento preventivos</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="formAddMtto" class="formAddMtto">
                    @*   <div class="mb-2">
                    <label for="imageAfter">Imagen</label>
                    <input type="file" id="imagenAfter" class="form-control form-control-sm" name="imagen_after"
                    accept="image/*">
                    </div> *@

                    <div class="mb-2">
                        <label for="IdPlanta">Planta</label>
                        <select id="IdPlanta" class="form-select" aria-label="Default select example" name="IdPlanta">
                            <option selected>Open this select menu</option>
                            <option value="MCH1">MCH1</option>
                            <option value="MCH2">MCH2</option>
                            <option value="MCH3">MCH3</option>
                        </select>
                    </div>

                    <div class="mb-2">
                        <label for="idLinea">ID de línea:</label>
                        <input type="text" id="idLinea" class="form-control form-control-sm" name="IdLinea">
                    </div>

                    <div class="mb-2">
                        <label for="Nserie">Número de serie:</label>
                        <input type="text" id="Nserie" class="form-control form-control-sm" name="Nserie">
                    </div>

                    <div class="mb-2">
                        <label for="comentarios">Comentarios:</label>
                        <input type="text" id="comentarios" class="form-control form-control-sm" name="comentarios">
                    </div>

                    <div class="mb-2">
                        <label for="problemasEncontrados">Problemas encontrados:</label>
                        <input type="text" id="problemasEncontrados" class="form-control form-control-sm" name="problemasEncontrados">
                    </div>

                    <div class="mb-2">
                        <label for="cambiosRealizados">Cambios realizados:</label>
                        <input type="text" id="cambiosRealizados" class="form-control form-control-sm" name="cambiosRealizados">
                    </div>

                    <div class="mb-2">
                        <label for="FechaPROG">Fecha de programación:</label>
                        <input type="date" id="FechaPROG" class="form-control form-control-sm" name="FechaPROG">
                    </div>

                    <div class="mb-2">
                        <label for="FechaRealiz">Fecha de realización:</label>
                        <input type="date" id="FechaRealiz" class="form-control form-control-sm" name="FechaRealiz">
                    </div>

                    <div class="mb-2">
                        <label for="estatus">Estatus:</label>
                        <input type="text" id="estatus" class="form-control form-control-sm" name="estatus">
                    </div>

                    <div class="mb-2">
                        <label for="estacion">Estación:</label>
                        <input type="text" id="estacion" class="form-control form-control-sm" name="estacion">
                    </div>


                    <hr>

                    <div class="container-buttons">
                        <button type="submit" id="btnSubmAddMtto" class="btn btn-success btn-sm btnSubmAddMtto">Agregar Mantenimiento</button>
                    </div>

                </form>

            </div>
        </div>
    </div>
</div>

<!-- MODAL 2-->
<div class="modal fade" id="exampleModalPDF" !important" tabindex="-1" aria-labelledby="exampleModalLabelPDF" aria-hidden="true">
    <div class="modal-dialog large modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabelPDF">Documento</h5>
                <button id="btn-close" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <embed id="pdfView" src="" type="application/pdf" width="100%" height="800px">
            </div>
        </div>
    </div>
</div>
<!-- MODAL 1-->



<script type="module">
    import { $, $a } from "/js/utils.js";
    import { obtenerDatosMtto, contenedorDatos, mostrarDetalles, mostrarModalAddProgandPDF, AddProgMTTOandPdf, mostrarModalAddMtto, AddMTTO } from '/js/MttoIndex.js'
    document.addEventListener('DOMContentLoaded', obtenerDatosMtto);

    //ADD programacion y PDF
    $('.btnAddProgandPDF').addEventListener('click', mostrarModalAddProgandPDF);
    $('.formAddProgramacionMtto').addEventListener('submit', AddProgMTTOandPdf);


    //ADD mantenimiento
    $('.idbtnAddMtto').addEventListener('click', mostrarModalAddMtto);
    $('.formAddMtto').addEventListener('submit', AddMTTO);
    //$('.formAddProgramacionMtto').addEventListener('submit', AddMTTOandPdf);


    //mostrar detalles mtto Y UPDATE

     //$('.formAddMtto').addEventListener('submit', AddMTTOandPdf);






    const filas = $a('.container-RowData');
    filas.forEach((fila) => {
        fila.addEventListener('click', mostrarDetalles);
    });

    const datePickerId = document.getElementById("selectfecha");
    datePickerId.addEventListener("input", () => {
        console.log(datePickerId.value);
        const day = datePickerId.value.substring(8, 10);
        console.log(day);
        // const day = date.getDay() + 1;
        console.log(day);
        if (day == 1 || day == 2 || day == 30 || day == 31) {
            datePickerId.value = ""; // Limpiar la selección
            Swal.fire({
                // title: 'Exito!',
                text: "Los días 1 , 2 ,30 y 31 están desactivados. Por favor, selecciona otra fecha.",
                icon: "info",
            });
            
        }
    });
</script>